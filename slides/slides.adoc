:source-highlighter: highlight.js
:revealjs_theme: redhat
:revealjs_controls: false
:revealjs_center: true
:revealjs_transition: concave

:images: ./misc


= Byteman tooling in JBoss EAP QE
Ondra Chaloupka / ochaloup@redhat.com

== Initial slide

[NOTE.speaker]
--
Ideas:

* demo where starting jboss with some initial btm configuration (e.g. after each doGet
  of a servlet some info could be printed) then connection to  running jvm process and
  add some rule (e.g. change servlet response text) and then delete rule
--

== Some traps

 * Use unique rule names

[NOTE.speaker]
--
* Unique rule name
  if unique name is not specfied then byteman will possibly crash JVM. For example
  by using byteman rule of printing info on jboss start up and rules have the same name

```
RULE say I am here
CLASS org.jboss.modules.Main
METHOD main
AT ENTRY
IF TRUE
DO System.out.println("Byteman is here");
ENDRULE

RULE say I am here
CLASS org.jboss.modules.Main
METHOD main
AT ENTRY
IF TRUE
DO System.out.println("Byteman is here2");
ENDRULE
```

will cause startup exception

```
Exception in thread "main" java.lang.reflect.InvocationTargetException
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke(Method.java:497)
 at sun.instrument.InstrumentationImpl.loadClassAndStartAgent(InstrumentationImpl.java:386)
 at sun.instrument.InstrumentationImpl.loadClassAndCallPremain(InstrumentationImpl.java:401)
Caused by: java.lang.reflect.InvocationTargetException
 at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
 at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
 at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
 at java.lang.reflect.Constructor.newInstance(Constructor.java:422)
 at org.jboss.byteman.agent.Main.premain(Main.java:272)
 ... 6 more
Caused by: java.lang.Exception: Transformer : duplicate script name say I am here in file /home/ochaloup/tmp/byteman.btm  line 24
 previously defined in file /home/ochaloup/tmp/byteman.btm  line 15
 at org.jboss.byteman.agent.Transformer.<init>(Transformer.java:95)
 ... 11 more
FATAL ERROR in native method: processing of -javaagent failed
./bin/standalone.sh: line 301: 30598 Aborted
```
--
